var MomentsApp=function(){"use strict";return class{constructor(t="#moments",e=10){this.pageSize=e,this.state={currentPage:1,totalPages:1,currentTag:null,isLoading:!1},this.appContainer=document.querySelector(t),this.createBaseStructure(),this.bindEvents()}createBaseStructure(){const t=document.createElement("div");t.id="current-tag",t.className="current-tag";const e=document.createElement("div");e.id="moment-list",e.className="moment-list",e.innerHTML='\n      <div class="loading-spinner">\n        <svg viewBox="25 25 50 50" class="circular">\n          <circle cx="50" cy="50" r="20" fill="none" class="path"></circle>\n        </svg>\n      </div>\n    ';const n=document.createElement("div");n.id="load-more",n.className="load-more",n.innerHTML='\n      <button type="button" id="loadMoreBtn" class="load-more-btn" disabled>\n          <i class="fas fa-spinner fa-spin"></i> 加载中...\n      </button>\n    ',this.appContainer.appendChild(t),this.appContainer.appendChild(e),this.appContainer.appendChild(n),this.momentsContainer=e,this.loadMoreBtn=document.getElementById("loadMoreBtn"),this.loadMoreContainer=n,this.currentTagContainer=t}init(){this.fetchMoments()}bindEvents(){this.loadMoreBtn.addEventListener("click",()=>this.loadMore()),this.momentsContainer.addEventListener("click",t=>{if(t.target.classList.contains("hashtag")){const e=t.target.dataset.tag;this.filterByTag(e)}})}loadMore(){this.state.currentPage+=1,this.fetchMoments()}filterByTag(t){this.state.currentTag=t,this.state.currentPage=1,this.fetchMoments()}clearTagFilter(){this.state.currentTag=null,this.state.currentPage=1,this.fetchMoments()}async fetchMoments(){this.state.isLoading=!0,this.updateLoadingState();try{let t=`/api/moments?pageSize=${this.pageSize}&page=${this.state.currentPage}`;this.state.currentTag&&(t+=`&tag=${this.state.currentTag}`);const e=await fetch(t),n=await e.json();this.state.totalPages=n.data.pagination.totalPages;const a=n.data.items||[];if(1===this.state.currentPage&&(this.momentsContainer.innerHTML="",this.resetLoadMoreContainer()),0===a.length)return void(this.momentsContainer.innerHTML='\n          <div class="no-more">\n            <p>没有找到相关说说</p>\n          </div>\n        ');a.forEach(t=>{const e=this.createMomentElement(t);this.momentsContainer.appendChild(e)}),this.updateLoadMoreState(),this.updateCurrentTagDisplay()}catch(t){console.error("加载说说失败:",t),this.momentsContainer.innerHTML='\n        <div class="error-message">\n          <p>加载说说失败，请稍后再试</p>\n          <button type="button" class="load-more-btn" onclick="momentsApp.fetchMoments()">\n            重新加载\n          </button>\n        </div>\n      '}finally{this.state.isLoading=!1,this.updateLoadingState()}}createMomentElement(t){t.content;const e=document.createElement("div");return e.className="moment-item",e.innerHTML=`\n      <div class="moment-card">\n        <div class="moment-content">${t.content}</div>\n      </div>\n      <div class="moment-meta">\n        <span class="moment-time">${t.created}</span>\n        <span class="moment-from">来自「${t.from}」</span>\n      </div>\n    `,e}updateLoadingState(){this.state.isLoading?(this.loadMoreBtn.disabled=!0,this.loadMoreBtn.innerHTML="^_^努力加载中..."):(this.loadMoreBtn.disabled=!1,this.loadMoreBtn.innerHTML=`加载更多 (${this.state.currentPage}/${this.state.totalPages})`)}updateLoadMoreState(){this.state.currentPage>=this.state.totalPages?this.loadMoreContainer.innerHTML="":(this.loadMoreContainer.innerHTML=`\n        <button type="button" id="loadMoreBtn" class="load-more-btn">\n          加载更多 (${this.state.currentPage}/${this.state.totalPages})\n        </button>\n      `,document.getElementById("loadMoreBtn").addEventListener("click",()=>this.loadMore()))}resetLoadMoreContainer(){this.loadMoreContainer.innerHTML=`\n      <button type="button" id="loadMoreBtn" class="load-more-btn">\n        加载更多 (${this.state.currentPage}/${this.state.totalPages})\n      </button>\n    `,document.getElementById("loadMoreBtn").addEventListener("click",()=>this.loadMore())}updateCurrentTagDisplay(){if(this.currentTagContainer.innerHTML="",this.state.currentTag){const t=document.createElement("div");t.className="tag-pill",t.innerHTML=`\n        ${this.state.currentTag}\n        <span class="close" id="clearTagBtn">×</span>\n      `;const e=document.createElement("div");e.className="tag-label",e.textContent="当前话题:",this.currentTagContainer.appendChild(e),this.currentTagContainer.appendChild(t),document.getElementById("clearTagBtn").addEventListener("click",()=>this.clearTagFilter())}}}}();
